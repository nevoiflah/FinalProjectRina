<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AI Robot Chat</title>
	<link rel="stylesheet" href="./styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
	<!-- Start Screen -->
	<div id="startScreen" class="screen">
		<div class="center-content">
			<!-- User Menu -->
			<div class="user-menu">
				<button id="profileBtn" class="icon-btn user-menu-btn" title="My Profile">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
						<circle cx="12" cy="7" r="4"></circle>
					</svg>
				</button>
				<button id="logoutBtn" class="icon-btn user-menu-btn" title="Logout">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
						<polyline points="16 17 21 12 16 7"></polyline>
						<line x1="21" y1="12" x2="9" y2="12"></line>
					</svg>
				</button>
			</div>

			<div class="robot-icon">ü§ñ</div>
			<h1 class="main-title">AI Robot Assistant</h1>
			<p class="main-subtitle">Your intelligent conversational companion</p>
			<p class="user-greeting" id="userGreeting">Welcome back!</p>
			<button id="startChatBtn" class="primary-btn">Start Chat</button>
		</div>
	</div>

	<!-- Chat Screen -->
	<div id="chatScreen" class="screen hidden">
		<div class="chat-container">
			<header class="chat-header">
				<button id="backBtn" class="back-btn">‚Üê</button>
				<div class="header-center">
					<div class="bot-avatar">ü§ñ</div>
					<div>
						<div class="bot-name">AI Assistant</div>
						<div class="bot-status">Online</div>
					</div>
				</div>
				<div class="header-actions">
					<button id="ttsToggle" class="icon-btn" title="Voice responses OFF" aria-pressed="false">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.5">
							<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
							<path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
							<path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
						</svg>
					</button>
				</div>
			</header>

			<main class="chat-messages" id="chatMessages">
				<!-- Messages will be added dynamically -->
			</main>

			<footer class="chat-input-area">
				<div class="input-wrapper">
					<button id="micBtn" class="mic-btn" title="Record voice message">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
							<path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
						</svg>
					</button>
					<input 
						type="text" 
						id="messageInput" 
						class="message-input" 
						placeholder="Type your message..."
					/>
					<button id="sendBtn" class="send-btn" title="Send message">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<line x1="22" y1="2" x2="11" y2="13"></line>
							<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
						</svg>
					</button>
				</div>
				<div id="recordingIndicator" class="recording-indicator hidden">
					<div class="recording-dot"></div>
					<span>Recording... Tap mic to stop and review</span>
				</div>
			</footer>
		</div>
	</div>

	<audio id="ttsAudio" preload="auto"></audio>

	<script>
		(function () {
			const raw = localStorage.getItem('chatUser');
			if (!raw) {
				window.location.replace('login.html');
				return;
			}
			try {
				const user = JSON.parse(raw);
				window.__CHAT_USER__ = user;
				
				// Display user greeting
				const userGreeting = document.getElementById('userGreeting');
				if (userGreeting && user) {
					const name = user.name || user.Name || 'User';
					const firstName = name.split(' ')[0];
					userGreeting.textContent = `Welcome back, ${firstName}!`;
				}
			} catch {
				localStorage.removeItem('chatUser');
				window.location.replace('login.html');
			}

			// Profile button
			const profileBtn = document.getElementById('profileBtn');
			if (profileBtn) {
				profileBtn.addEventListener('click', () => {
					window.location.href = 'profile.html';
				});
			}

			// Logout button
			const logoutBtn = document.getElementById('logoutBtn');
			if (logoutBtn) {
				logoutBtn.addEventListener('click', () => {
					const confirmed = confirm('Are you sure you want to logout?');
					if (confirmed) {
						localStorage.removeItem('chatUser');
						window.location.replace('login.html');
					}
				});
			}
		})();
	</script>
	<script src="./config.js"></script>
	<script src="./api.js"></script>
	<script src="./script.js"></script>
	<script src="./app.js"></script>
</body>
</html>